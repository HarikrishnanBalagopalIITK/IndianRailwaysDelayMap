{"version":3,"sources":["../src/FileSaver.js","node_modules/d3-queue/build/d3-queue.js","node_modules/leaflet-image/index.js","main.js"],"names":["cout","console","log","cerr","error","sel","s","document","querySelector","middleindiacoords","NDLScoords","DELAY_MIN","DELAY_MAX","DELAY_RANGE","PARTITIONS","STEP","delayRangeColors","accessToken","stationMarkers","stationData","stationsByName","options","searchBar","newMap","satelliteLayer","streetsLayer","counter","main","createMap","Worker","onmessage","event","handleRow","attribution","tileOptions","maxZoom","mapBoxURL","L","tileLayer","id","mapOptions","preferCanvas","layers","center","zoom","map","normalizeStationName","name","trim","toLowerCase","roundValue","value","Math","round","Number","EPSILON","data","nextStage","length","isValid","normalized_name","station_name","station_code","red","blueToRed","yr_mean","delayColor","color","colorClass","i","threshold","stationPopupHtml","yr_std","oct17_mean","oct17_std","nov17_mean","nov17_std","dec17_mean","dec17_std","jan18_mean","jan18_std","feb18_mean","feb18_std","mar18_mean","mar18_std","apr18_mean","apr18_std","may18_mean","may18_std","jun18_mean","jun18_std","jul18_mean","jul18_std","aug18_mean","aug18_std","sep18_mean","sep18_std","oct18_mean","oct18_std","christmas17_mean","christmas17_std","diwali18_mean","diwali18_std","holi18_mean","holi18_std","marker","circleMarker","longitude","latitude","radius","bindPopup","push","option","createElement","stationsLayer","layerGroup","addLayer","baseMaps","overlayMaps","control","addTo","dataList","append","body","appendChild","addEventListener","e","key","handleSearch","saveButton","handleClickSave","classList","add","openPopup","query","toUpperCase","station","panTo","alert","delay","x","loading","remove","err","canvas","filename","Date","toBlob","blob"],"mappings":"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","file":"main.5a94bdee.js","sourceRoot":"..","sourcesContent":["/*\n* FileSaver.js\n* A saveAs() FileSaver implementation.\n*\n* By Eli Grey, http://eligrey.com\n*\n* License : https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md (MIT)\n* source  : http://purl.eligrey.com/github/FileSaver.js\n*/\n\n// The one and only way of getting global scope in all environments\n// https://stackoverflow.com/q/3277182/1008999\nvar _global = typeof window === 'object' && window.window === window\n  ? window : typeof self === 'object' && self.self === self\n  ? self : typeof global === 'object' && global.global === global\n  ? global\n  : this\n\nfunction bom (blob, opts) {\n  if (typeof opts === 'undefined') opts = { autoBom: false }\n  else if (typeof opts !== 'object') {\n    console.warn('Deprecated: Expected third argument to be a object')\n    opts = { autoBom: !opts }\n  }\n\n  // prepend BOM for UTF-8 XML and text/* types (including HTML)\n  // note: your browser will automatically convert UTF-16 U+FEFF to EF BB BF\n  if (opts.autoBom && /^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(blob.type)) {\n    return new Blob([String.fromCharCode(0xFEFF), blob], { type: blob.type })\n  }\n  return blob\n}\n\nfunction download (url, name, opts) {\n  var xhr = new XMLHttpRequest()\n  xhr.open('GET', url)\n  xhr.responseType = 'blob'\n  xhr.onload = function () {\n    saveAs(xhr.response, name, opts)\n  }\n  xhr.onerror = function () {\n    console.error('could not download file')\n  }\n  xhr.send()\n}\n\nfunction corsEnabled (url) {\n  var xhr = new XMLHttpRequest()\n  // use sync to avoid popup blocker\n  xhr.open('HEAD', url, false)\n  try {\n    xhr.send()\n  } catch (e) {}\n  return xhr.status >= 200 && xhr.status <= 299\n}\n\n// `a.click()` doesn't work for all browsers (#465)\nfunction click (node) {\n  try {\n    node.dispatchEvent(new MouseEvent('click'))\n  } catch (e) {\n    var evt = document.createEvent('MouseEvents')\n    evt.initMouseEvent('click', true, true, window, 0, 0, 0, 80,\n                          20, false, false, false, false, 0, null)\n    node.dispatchEvent(evt)\n  }\n}\n\nvar saveAs = _global.saveAs || (\n  // probably in some web worker\n  (typeof window !== 'object' || window !== _global)\n    ? function saveAs () { /* noop */ }\n\n  // Use download attribute first if possible (#193 Lumia mobile)\n  : 'download' in HTMLAnchorElement.prototype\n  ? function saveAs (blob, name, opts) {\n    var URL = _global.URL || _global.webkitURL\n    var a = document.createElement('a')\n    name = name || blob.name || 'download'\n\n    a.download = name\n    a.rel = 'noopener' // tabnabbing\n\n    // TODO: detect chrome extensions & packaged apps\n    // a.target = '_blank'\n\n    if (typeof blob === 'string') {\n      // Support regular links\n      a.href = blob\n      if (a.origin !== location.origin) {\n        corsEnabled(a.href)\n          ? download(blob, name, opts)\n          : click(a, a.target = '_blank')\n      } else {\n        click(a)\n      }\n    } else {\n      // Support blobs\n      a.href = URL.createObjectURL(blob)\n      setTimeout(function () { URL.revokeObjectURL(a.href) }, 4E4) // 40s\n      setTimeout(function () { click(a) }, 0)\n    }\n  }\n\n  // Use msSaveOrOpenBlob as a second approach\n  : 'msSaveOrOpenBlob' in navigator\n  ? function saveAs (blob, name, opts) {\n    name = name || blob.name || 'download'\n\n    if (typeof blob === 'string') {\n      if (corsEnabled(blob)) {\n        download(blob, name, opts)\n      } else {\n        var a = document.createElement('a')\n        a.href = blob\n        a.target = '_blank'\n        setTimeout(function () { click(a) })\n      }\n    } else {\n      navigator.msSaveOrOpenBlob(bom(blob, opts), name)\n    }\n  }\n\n  // Fallback to using FileReader and a popup\n  : function saveAs (blob, name, opts, popup) {\n    // Open a popup immediately do go around popup blocker\n    // Mostly only available on user interaction and the fileReader is async so...\n    popup = popup || open('', '_blank')\n    if (popup) {\n      popup.document.title =\n      popup.document.body.innerText = 'downloading...'\n    }\n\n    if (typeof blob === 'string') return download(blob, name, opts)\n\n    var force = blob.type === 'application/octet-stream'\n    var isSafari = /constructor/i.test(_global.HTMLElement) || _global.safari\n    var isChromeIOS = /CriOS\\/[\\d]+/.test(navigator.userAgent)\n\n    if ((isChromeIOS || (force && isSafari)) && typeof FileReader === 'object') {\n      // Safari doesn't allow downloading of blob URLs\n      var reader = new FileReader()\n      reader.onloadend = function () {\n        var url = reader.result\n        url = isChromeIOS ? url : url.replace(/^data:[^;]*;/, 'data:attachment/file;')\n        if (popup) popup.location.href = url\n        else location = url\n        popup = null // reverse-tabnabbing #460\n      }\n      reader.readAsDataURL(blob)\n    } else {\n      var URL = _global.URL || _global.webkitURL\n      var url = URL.createObjectURL(blob)\n      if (popup) popup.location = url\n      else location.href = url\n      popup = null // reverse-tabnabbing #460\n      setTimeout(function () { URL.revokeObjectURL(url) }, 4E4) // 40s\n    }\n  }\n)\n\n_global.saveAs = saveAs.saveAs = saveAs\n\nif (typeof module !== 'undefined') {\n  module.exports = saveAs;\n}\n","(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n  typeof define === 'function' && define.amd ? define(['exports'], factory) :\n  (factory((global.d3_queue = global.d3_queue || {})));\n}(this, function (exports) { 'use strict';\n\n  var version = \"2.0.3\";\n\n  var slice = [].slice;\n\n  var noabort = {};\n\n  function Queue(size) {\n    if (!(size >= 1)) throw new Error;\n    this._size = size;\n    this._call =\n    this._error = null;\n    this._tasks = [];\n    this._data = [];\n    this._waiting =\n    this._active =\n    this._ended =\n    this._start = 0; // inside a synchronous task callback?\n  }\n\n  Queue.prototype = queue.prototype = {\n    constructor: Queue,\n    defer: function(callback) {\n      if (typeof callback !== \"function\" || this._call) throw new Error;\n      if (this._error != null) return this;\n      var t = slice.call(arguments, 1);\n      t.push(callback);\n      ++this._waiting, this._tasks.push(t);\n      poke(this);\n      return this;\n    },\n    abort: function() {\n      if (this._error == null) abort(this, new Error(\"abort\"));\n      return this;\n    },\n    await: function(callback) {\n      if (typeof callback !== \"function\" || this._call) throw new Error;\n      this._call = function(error, results) { callback.apply(null, [error].concat(results)); };\n      maybeNotify(this);\n      return this;\n    },\n    awaitAll: function(callback) {\n      if (typeof callback !== \"function\" || this._call) throw new Error;\n      this._call = callback;\n      maybeNotify(this);\n      return this;\n    }\n  };\n\n  function poke(q) {\n    if (!q._start) try { start(q); } // let the current task complete\n    catch (e) { if (q._tasks[q._ended + q._active - 1]) abort(q, e); } // task errored synchronously\n  }\n\n  function start(q) {\n    while (q._start = q._waiting && q._active < q._size) {\n      var i = q._ended + q._active,\n          t = q._tasks[i],\n          j = t.length - 1,\n          c = t[j];\n      t[j] = end(q, i);\n      --q._waiting, ++q._active;\n      t = c.apply(null, t);\n      if (!q._tasks[i]) continue; // task finished synchronously\n      q._tasks[i] = t || noabort;\n    }\n  }\n\n  function end(q, i) {\n    return function(e, r) {\n      if (!q._tasks[i]) return; // ignore multiple callbacks\n      --q._active, ++q._ended;\n      q._tasks[i] = null;\n      if (q._error != null) return; // ignore secondary errors\n      if (e != null) {\n        abort(q, e);\n      } else {\n        q._data[i] = r;\n        if (q._waiting) poke(q);\n        else maybeNotify(q);\n      }\n    };\n  }\n\n  function abort(q, e) {\n    var i = q._tasks.length, t;\n    q._error = e; // ignore active callbacks\n    q._data = undefined; // allow gc\n    q._waiting = NaN; // prevent starting\n\n    while (--i >= 0) {\n      if (t = q._tasks[i]) {\n        q._tasks[i] = null;\n        if (t.abort) try { t.abort(); }\n        catch (e) { /* ignore */ }\n      }\n    }\n\n    q._active = NaN; // allow notification\n    maybeNotify(q);\n  }\n\n  function maybeNotify(q) {\n    if (!q._active && q._call) q._call(q._error, q._data);\n  }\n\n  function queue(concurrency) {\n    return new Queue(arguments.length ? +concurrency : Infinity);\n  }\n\n  exports.version = version;\n  exports.queue = queue;\n\n}));","/* global L */\n\nvar queue = require('d3-queue').queue;\n\nvar cacheBusterDate = +new Date();\n\n// leaflet-image\nmodule.exports = function leafletImage(map, callback) {\n\n    var hasMapbox = !!L.mapbox;\n\n    var dimensions = map.getSize(),\n        layerQueue = new queue(1);\n\n    var canvas = document.createElement('canvas');\n    canvas.width = dimensions.x;\n    canvas.height = dimensions.y;\n    var ctx = canvas.getContext('2d');\n\n    // dummy canvas image when loadTile get 404 error\n    // and layer don't have errorTileUrl\n    var dummycanvas = document.createElement('canvas');\n    dummycanvas.width = 1;\n    dummycanvas.height = 1;\n    var dummyctx = dummycanvas.getContext('2d');\n    dummyctx.fillStyle = 'rgba(0,0,0,0)';\n    dummyctx.fillRect(0, 0, 1, 1);\n\n    // layers are drawn in the same order as they are composed in the DOM:\n    // tiles, paths, and then markers\n    map.eachLayer(drawTileLayer);\n    map.eachLayer(drawEsriDynamicLayer);\n    \n    if (map._pathRoot) {\n        layerQueue.defer(handlePathRoot, map._pathRoot);\n    } else if (map._panes) {\n        var firstCanvas = map._panes.overlayPane.getElementsByTagName('canvas').item(0);\n        if (firstCanvas) { layerQueue.defer(handlePathRoot, firstCanvas); }\n    }\n    map.eachLayer(drawMarkerLayer);\n    layerQueue.awaitAll(layersDone);\n\n    function drawTileLayer(l) {\n        if (l instanceof L.TileLayer) layerQueue.defer(handleTileLayer, l);\n        else if (l._heat) layerQueue.defer(handlePathRoot, l._canvas);\n    }\n\n    function drawMarkerLayer(l) {\n        if (l instanceof L.Marker && l.options.icon instanceof L.Icon) {\n            layerQueue.defer(handleMarkerLayer, l);\n        }\n    }\n    \n    function drawEsriDynamicLayer(l) {\n        if (!L.esri) return;\n       \n        if (l instanceof L.esri.DynamicMapLayer) {                       \n            layerQueue.defer(handleEsriDymamicLayer, l);\n        }\n    }\n\n    function done() {\n        callback(null, canvas);\n    }\n\n    function layersDone(err, layers) {\n        if (err) throw err;\n        layers.forEach(function (layer) {\n            if (layer && layer.canvas) {\n                ctx.drawImage(layer.canvas, 0, 0);\n            }\n        });\n        done();\n    }\n\n    function handleTileLayer(layer, callback) {\n        // `L.TileLayer.Canvas` was removed in leaflet 1.0\n        var isCanvasLayer = (L.TileLayer.Canvas && layer instanceof L.TileLayer.Canvas),\n            canvas = document.createElement('canvas');\n\n        canvas.width = dimensions.x;\n        canvas.height = dimensions.y;\n\n        var ctx = canvas.getContext('2d'),\n            bounds = map.getPixelBounds(),\n            zoom = map.getZoom(),\n            tileSize = layer.options.tileSize;\n\n        if (zoom > layer.options.maxZoom ||\n            zoom < layer.options.minZoom ||\n            // mapbox.tileLayer\n            (hasMapbox &&\n                layer instanceof L.mapbox.tileLayer && !layer.options.tiles)) {\n            return callback();\n        }\n\n        var tileBounds = L.bounds(\n            bounds.min.divideBy(tileSize)._floor(),\n            bounds.max.divideBy(tileSize)._floor()),\n            tiles = [],\n            j, i,\n            tileQueue = new queue(1);\n\n        for (j = tileBounds.min.y; j <= tileBounds.max.y; j++) {\n            for (i = tileBounds.min.x; i <= tileBounds.max.x; i++) {\n                tiles.push(new L.Point(i, j));\n            }\n        }\n\n        tiles.forEach(function (tilePoint) {\n            var originalTilePoint = tilePoint.clone();\n\n            if (layer._adjustTilePoint) {\n                layer._adjustTilePoint(tilePoint);\n            }\n\n            var tilePos = originalTilePoint\n                .scaleBy(new L.Point(tileSize, tileSize))\n                .subtract(bounds.min);\n\n            if (tilePoint.y >= 0) {\n                if (isCanvasLayer) {\n                    var tile = layer._tiles[tilePoint.x + ':' + tilePoint.y];\n                    tileQueue.defer(canvasTile, tile, tilePos, tileSize);\n                } else {\n                    var url = addCacheString(layer.getTileUrl(tilePoint));\n                    tileQueue.defer(loadTile, url, tilePos, tileSize);\n                }\n            }\n        });\n\n        tileQueue.awaitAll(tileQueueFinish);\n\n        function canvasTile(tile, tilePos, tileSize, callback) {\n            callback(null, {\n                img: tile,\n                pos: tilePos,\n                size: tileSize\n            });\n        }\n\n        function loadTile(url, tilePos, tileSize, callback) {\n            var im = new Image();\n            im.crossOrigin = '';\n            im.onload = function () {\n                callback(null, {\n                    img: this,\n                    pos: tilePos,\n                    size: tileSize\n                });\n            };\n            im.onerror = function (e) {\n                // use canvas instead of errorTileUrl if errorTileUrl get 404\n                if (layer.options.errorTileUrl != '' && e.target.errorCheck === undefined) {\n                    e.target.errorCheck = true;\n                    e.target.src = layer.options.errorTileUrl;\n                } else {\n                    callback(null, {\n                        img: dummycanvas,\n                        pos: tilePos,\n                        size: tileSize\n                    });\n                }\n            };\n            im.src = url;\n        }\n\n        function tileQueueFinish(err, data) {\n            data.forEach(drawTile);\n            callback(null, { canvas: canvas });\n        }\n\n        function drawTile(d) {\n            ctx.drawImage(d.img, Math.floor(d.pos.x), Math.floor(d.pos.y),\n                d.size, d.size);\n        }\n    }\n\n    function handlePathRoot(root, callback) {\n        var bounds = map.getPixelBounds(),\n            origin = map.getPixelOrigin(),\n            canvas = document.createElement('canvas');\n        canvas.width = dimensions.x;\n        canvas.height = dimensions.y;\n        var ctx = canvas.getContext('2d');\n        var pos = L.DomUtil.getPosition(root).subtract(bounds.min).add(origin);\n        try {\n            ctx.drawImage(root, pos.x, pos.y, canvas.width - (pos.x * 2), canvas.height - (pos.y * 2));\n            callback(null, {\n                canvas: canvas\n            });\n        } catch(e) {\n            console.error('Element could not be drawn on canvas', root); // eslint-disable-line no-console\n        }\n    }\n\n    function handleMarkerLayer(marker, callback) {\n        var canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d'),\n            pixelBounds = map.getPixelBounds(),\n            minPoint = new L.Point(pixelBounds.min.x, pixelBounds.min.y),\n            pixelPoint = map.project(marker.getLatLng()),\n            isBase64 = /^data\\:/.test(marker._icon.src),\n            url = isBase64 ? marker._icon.src : addCacheString(marker._icon.src),\n            im = new Image(),\n            options = marker.options.icon.options,\n            size = options.iconSize,\n            pos = pixelPoint.subtract(minPoint),\n            anchor = L.point(options.iconAnchor || size && size.divideBy(2, true));\n\n        if (size instanceof L.Point) size = [size.x, size.y];\n\n        var x = Math.round(pos.x - size[0] + anchor.x),\n            y = Math.round(pos.y - anchor.y);\n\n        canvas.width = dimensions.x;\n        canvas.height = dimensions.y;\n        im.crossOrigin = '';\n\n        im.onload = function () {\n            ctx.drawImage(this, x, y, size[0], size[1]);\n            callback(null, {\n                canvas: canvas\n            });\n        };\n\n        im.src = url;\n\n        if (isBase64) im.onload();\n    }\n    \n    function handleEsriDymamicLayer(dynamicLayer, callback) {\n        var canvas = document.createElement('canvas');\n        canvas.width = dimensions.x;\n        canvas.height = dimensions.y;\n    \n        var ctx = canvas.getContext('2d');\n    \n        var im = new Image();\n        im.crossOrigin = '';\n        im.src = addCacheString(dynamicLayer._currentImage._image.src);\n    \n        im.onload = function() {\n            ctx.drawImage(im, 0, 0);\n            callback(null, {\n                canvas: canvas\n            });\n        };\n    }\n\n    function addCacheString(url) {\n        // If it's a data URL we don't want to touch this.\n        if (isDataURL(url) || url.indexOf('mapbox.com/styles/v1') !== -1) {\n            return url;\n        }\n        return url + ((url.match(/\\?/)) ? '&' : '?') + 'cache=' + cacheBusterDate;\n    }\n\n    function isDataURL(url) {\n        var dataURLRegex = /^\\s*data:([a-z]+\\/[a-z]+(;[a-z\\-]+\\=[a-z\\-]+)?)?(;base64)?,[a-z0-9\\!\\$\\&\\'\\,\\(\\)\\*\\+\\,\\;\\=\\-\\.\\_\\~\\:\\@\\/\\?\\%\\s]*\\s*$/i;\n        return !!url.match(dataURLRegex);\n    }\n\n};\n","import  { saveAs } from 'file-saver';\nimport leafletImage from 'leaflet-image';\n\nconst cout = console.log;\nconst cerr = console.error;\nconst sel = s => document.querySelector(s);\nconst middleindiacoords = [23.012455, 78.085792];\nconst NDLScoords = [28.642257, 77.218603];\nconst DELAY_MIN = 0;\nconst DELAY_MAX = 120;\nconst DELAY_RANGE = DELAY_MAX - DELAY_MIN;\nconst PARTITIONS = 5;\nconst STEP = DELAY_RANGE / PARTITIONS;\nconst delayRangeColors = ['blue', 'green', 'orange', 'yellow', 'red'];\n\nconst accessToken = 'pk.eyJ1IjoidGVzdGluZ21hcGJveGlpdGsiLCJhIjoiY2pvanlqN3JnMDFiOTNwbW5xbG83NnE1cSJ9.Fx5Gu72P14nE2qcVshLMbg';\n\nconst stationMarkers = [];\nconst stationData = {}, stationsByName = {}, options = [];\nconst searchBar = sel('#searchBar');\nlet newMap = null;\nlet satelliteLayer = null;\nlet streetsLayer = null;\n\nlet counter = 4;\n\n// MAIN\n\nmain();\n\nfunction main()\n{\n    cout('hi from the main thread');\n\n    newMap = createMap();\n\n    const worker = new Worker('worker.js');\n    worker.onmessage = event => handleRow(event, newMap);\n}\n\n// FUNCTIONS\n\nfunction createMap()\n{\n    const attribution = 'Map data &copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery © <a href=\"https://www.mapbox.com/\">Mapbox</a>';\n    const tileOptions = { attribution, accessToken, maxZoom: 18 };\n    const mapBoxURL = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}';\n\n    satelliteLayer = L.tileLayer(mapBoxURL, {...tileOptions, id: 'mapbox.satellite'});\n    streetsLayer = L.tileLayer(mapBoxURL, {...tileOptions, id: 'mapbox.streets'});\n    const mapOptions = {\n        preferCanvas: true,\n        layers: [satelliteLayer],\n        center: NDLScoords,\n        zoom: 10\n    };\n    const newMap = L.map('mapid', mapOptions)\n\n    return newMap;\n}\n\nconst normalizeStationName = name => name.trim().toLowerCase();\nconst roundValue = value => Math.round((value + Number.EPSILON) * 100) / 100;\n\nfunction handleRow(event, newMap)\n{\n    if(event.data === 'done')\n    {\n        cout('worker is done');\n        return nextStage(newMap);\n    }\n\n    if(event.data.length < 1)return cout('length of row < 1');\n\n    const data = event.data[0];\n    if(!isValid(data))\n    {\n        if(counter < 1)return;\n        counter--;\n        cout('event:', event)\n        return cout('data is not valid');\n    }\n    const normalized_name = normalizeStationName(data.station_name);\n\n    stationData[data.station_code] = data;\n    stationsByName[normalized_name] = data;\n  \n    //const delayColor = {color: '#FF0000', colorClass: 'red'};\n\n    const red = blueToRed(data.yr_mean);\n    const delayColor = {color: `rgb(${red}, 0, ${255 - red})`, colorClass: 'red'}\n\n    for(let i = 0, threshold = DELAY_MIN; i < PARTITIONS; i++, threshold += STEP)\n    {\n        if(data.yr_mean < threshold)break;\n        delayColor.colorClass = delayRangeColors[i];\n    }\n    /*\n    for(let threshold in delayRange)\n    {\n        if(data.yr_mean < threshold)\n        {\n            const [color, colorClass] = delayRange[threshold];\n            //delayColor.color = color;\n            delayColor.colorClass = colorClass;\n            break;\n        }\n    }\n    */\n\n    const stationPopupHtml = `\n    <div class=\"station_name\">${data.station_name}(${data.station_code})</div>\n    <div class=\"station_delay ${delayColor.colorClass}\">\n\n        <div>Time period</div><div>Mean delay<br/>(in minutes)</div><div>Standard deviation<br/>of delay</div>\n        <div>Oct 2017 to Oct 2018</div><div>${roundValue(data.yr_mean)}</div><div>${roundValue(data.yr_std)}</div>\n        <div>October 2017</div><div>${roundValue(data.oct17_mean)}</div><div>${roundValue(data.oct17_std)}</div>\n        <div>November 2017</div><div>${roundValue(data.nov17_mean)}</div><div>${roundValue(data.nov17_std)}</div>\n        <div>Decmber 2017</div><div>${roundValue(data.dec17_mean)}</div><div>${roundValue(data.dec17_std)}</div>\n        <div>January 2018</div><div>${roundValue(data.jan18_mean)}</div><div>${roundValue(data.jan18_std)}</div>\n        <div>February 2018</div><div>${roundValue(data.feb18_mean)}</div><div>${roundValue(data.feb18_std)}</div>\n        <div>March 2018</div><div>${roundValue(data.mar18_mean)}</div><div>${roundValue(data.mar18_std)}</div>\n        <div>April 2018</div><div>${roundValue(data.apr18_mean)}</div><div>${roundValue(data.apr18_std)}</div>\n        <div>May 2018</div><div>${roundValue(data.may18_mean)}</div><div>${roundValue(data.may18_std)}</div>\n        <div>June 2018</div><div>${roundValue(data.jun18_mean)}</div><div>${roundValue(data.jun18_std)}</div>\n        <div>July 2018</div><div>${roundValue(data.jul18_mean)}</div><div>${roundValue(data.jul18_std)}</div>\n        <div>August 2018</div><div>${roundValue(data.aug18_mean)}</div><div>${roundValue(data.aug18_std)}</div>\n        <div>September 2018</div><div>${roundValue(data.sep18_mean)}</div><div>${roundValue(data.sep18_std)}</div>\n        <div>October 2018</div><div>${roundValue(data.oct18_mean)}</div><div>${roundValue(data.oct18_std)}</div>\n        <div>Christmas 2017</div><div>${roundValue(data.christmas17_mean)}</div><div>${roundValue(data.christmas17_std)}</div>\n        <div>Diwali 2018</div><div>${roundValue(data.diwali18_mean)}</div><div>${roundValue(data.diwali18_std)}</div>\n        <div>Holi 2018</div><div>${roundValue(data.holi18_mean)}</div><div>${roundValue(data.holi18_std)}</div>\n\n    </div>\n    `;\n  \n    const marker = L.circleMarker([data.longitude, data.latitude], {radius: 1, color: delayColor.color})\n    marker.bindPopup(stationPopupHtml);//.addTo(newMap);\n    stationMarkers.push(marker);\n\n    stationData[data.station_code].marker = marker;\n    stationsByName[normalized_name].marker = marker;\n\n    const option = document.createElement('option');\n    option.value = normalized_name;\n    options.push(option);\n}\n\nfunction isValid(data)\n{\n    if(!('latitude' in data) || data['latitude'] === null)return false;\n    if(!('longitude' in data) || data['longitude'] === null)return false;\n    if(!('station_code' in data) || data['station_code'] === null)return false;\n    return true;\n}\n\nfunction nextStage(newMap)\n{\n    const stationsLayer = L.layerGroup(stationMarkers);\n    newMap.addLayer(stationsLayer);\n    var baseMaps = {\n        \"Satellite\": satelliteLayer,\n        \"Streets\": streetsLayer\n    };\n    var overlayMaps = {\n        \"Stations\": stationsLayer\n    };\n    L.control.layers(baseMaps, overlayMaps).addTo(newMap);\n\n    const dataList = document.createElement('datalist');\n    dataList.id = 'stations-name-list';\n    dataList.append(...options);\n    document.body.appendChild(dataList);\n\n    // Hack for firefox for desktop start.\n    // Firefox version 70.0.1 on Windows 10 doesn't fire change event when a option is selected.\n    searchBar.addEventListener('keyup', e =>\n    {\n        if(e.key !== 'Enter')return;\n        handleSearch();\n    });\n    // Hack for firefox for desktop end.\n\n    searchBar.addEventListener('change', () => handleSearch());\n\n    const saveButton = sel('#save');\n    saveButton.addEventListener('click', () => handleClickSave(saveButton, newMap));\n    const loading = sel('#loading');\n    loading.classList.add('hidden');\n\n    stationData['NDLS'].marker.openPopup();\n}\n\nfunction handleSearch()\n{\n    const query = searchBar.value.trim().toUpperCase();\n    if(query in stationData)\n    {\n        cout('Found it');\n        const station = stationData[query];\n        newMap.panTo([station.longitude, station.latitude]);\n        station.marker.openPopup();\n    }\n    else if(query.toLowerCase() in stationsByName)\n    {\n        cout('Found it');\n        const station = stationsByName[query.toLowerCase()];\n        newMap.panTo([station.longitude, station.latitude]);\n        station.marker.openPopup();\n    }\n    else\n    {\n        return alert(\"Couldn't find station\");\n    }\n}\n\nfunction blueToRed(delay)\n{\n    let x = 0;\n    if(delay > DELAY_MAX)x = 1;\n    else if(delay < DELAY_MIN)x = 0;\n    else x = (delay - DELAY_MIN) / DELAY_RANGE;\n\n    return x * 255;\n}\n\nfunction handleClickSave(saveButton, map)\n{\n    const loading = sel('#loading');\n    loading.classList.remove('hidden');\n\n    leafletImage(map, (err, canvas) => {\n        loading.classList.add('hidden');\n\n        if(err)return cout(err);\n\n        const filename = `map_saved_at_${Date()}.png`;\n        canvas.toBlob(blob => saveAs(blob, filename));\n    });\n}"]}